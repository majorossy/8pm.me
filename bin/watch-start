#!/usr/bin/env bash
set -e

PID_FILE="/tmp/8pm-watch.pid"
LOG_FILE="/tmp/8pm-watch.log"

# Check if already running
if [ -f "$PID_FILE" ] && kill -0 $(cat "$PID_FILE") 2>/dev/null; then
    echo "âš ï¸  File watcher already running (PID: $(cat $PID_FILE))"
    echo "ðŸ“‹ Logs: tail -f $LOG_FILE"
    exit 0
fi

echo "ðŸš€ Starting file watcher in background..."

# Start watcher in background
nohup bin/watch > "$LOG_FILE" 2>&1 &
echo $! > "$PID_FILE"

echo "âœ… File watcher started (PID: $(cat $PID_FILE))"
echo "ðŸ“‹ Logs: tail -f $LOG_FILE"
echo "ðŸ›‘ Stop: bin/watch-stop"
